<mat-toolbar color="primary">
  <span>Minhas Tarefas</span>
  <span class="toolbar-spacer"></span>
  <button mat-icon-button (click)="logout()" aria-label="Sair">
    <mat-icon>logout</mat-icon>
  </button>
</mat-toolbar>

<div class="todo-list">
  @if (error()) {
    <mat-card class="todo-list__error">
      <mat-card-content>
        <p>{{ error() }}</p>
      </mat-card-content>
    </mat-card>
  }

  <div class="todo-list__controls">
    <div class="todo-list__summary">
      <h2 class="todo-list__summary-title">Resumo</h2>
      <p class="todo-list__summary-count">{{ completedCount() }} de {{ tasks().length }} concluídas</p>
    </div>
    <app-task-filter [categories]="categories" (categoryChange)="handleCategoryChange($event)" />
  </div>

  <div class="todo-list__main">
    <div class="todo-list__form-container">
      <app-add-task-form [categories]="categories" (taskAdded)="handleTaskAdded($event)" />
    </div>
    <div class="todo-list__list-container">
      @if (loading()) {
        <!-- Skeleton Loader -->
        @for (i of [1, 2, 3]; track i) {
          <mat-card class="task-item-skeleton">
            <div class="skeleton-content">
              <ngx-skeleton-loader count="1" appearance="circle" [theme]="{ width: '24px', height: '24px' }"></ngx-skeleton-loader>
              <div class="skeleton-text">
                <ngx-skeleton-loader count="1" appearance="line" [theme]="{ width: '60%' }"></ngx-skeleton-loader>
                <ngx-skeleton-loader count="1" appearance="line" [theme]="{ width: '40%' }"></ngx-skeleton-loader>
              </div>
            </div>
          </mat-card>
        }
      } @else {
        <!-- Actual Task List -->
        @if (filteredTasks().length > 0) {
          <app-task-list
            [tasks]="filteredTasks()"
            [editingTaskId]="editingTaskId()"
            [categories]="categories"
            (toggleComplete)="handleToggleComplete($event)"
            (delete)="handleDelete($event)"
            (edit)="handleEdit($event)"
            (save)="handleSave($event)"
            (cancel)="handleCancelEdit()"
          />
        } @else {
          <div class="no-tasks-message">
            <mat-icon>inbox</mat-icon>
            <p>Nenhuma tarefa encontrada.</p>
            <p class="subtle-text">Que tal adicionar uma nova para começar?</p>
          </div>
        }
      }
    </div>
  </div>
</div>