<div class="header">
  <h1>Minhas Tarefas (To-Do List)</h1>
  <button class="logout-btn" (click)="logout()">Sair</button>
</div>

<div class="new-task-form">
  <h3>Adicionar Nova Tarefa</h3>
  <form (ngSubmit)="addTask()">
    <input 
      type="text" 
      placeholder="O que precisa ser feito?" 
      [(ngModel)]="newTaskTitle" 
      name="taskTitle"
      required
    >
    <button type="submit">Adicionar</button>
  </form>
</div>

<div class="task-summary">
  <p>{{ completedCount }} de {{ tasks.length }} concluídas</p>
</div>

<div class="filters">
  <button (click)="filter='all'">Todas</button>
  <button (click)="filter='pending'">Pendentes</button>
  <button (click)="filter='completed'">Concluídas</button>
</div>

<div class="task-list">
  @if (filteredTasks.length === 0) {
    <p class="empty-message">Nenhuma tarefa encontrada. Comece adicionando uma!</p>
  } @else {
    <ul>
      @for (task of filteredTasks; track task.id) {
        <li [class.completed]="task.isComplete" 
            [class.editing]="editingTask?.id === task.id">

          <input type="checkbox" [(ngModel)]="task.isComplete" (change)="updateTask(task)">

          <!-- Se estiver editando esta tarefa -->
          @if (editingTask?.id === task.id) {
            <input type="text" [(ngModel)]="task.title" name="editTitle-{{task.id}}" class="edit-input">
            <button class="save-btn" (click)="updateTask(task)">Salvar</button>
            <button class="cancel-btn" (click)="cancelEdit()">Cancelar</button>
          } @else {
            <span class="task-title">{{ task.title }}</span>
            <div class="actions">
              <button class="edit-btn" (click)="startEdit(task)">Editar</button>
              <button class="delete-btn" (click)="deleteTask(task.id)">Excluir</button>
            </div>
          }
        </li>
      }
    </ul>
  }
</div>
