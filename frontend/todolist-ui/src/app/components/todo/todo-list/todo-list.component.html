<div class="todo-list-page">

  <!-- Cabe√ßalho -->
  <div class="header">
    <h1>Minhas Tarefas (To-Do List)</h1>
    <button class="logout-btn" (click)="logout()">Sair</button>
  </div>

  <!-- Resumo -->
  <div class="task-summary">
    <p>{{ completedCount() }} de {{ tasks().length }} conclu√≠das</p>
  </div>

  <!-- Filtros -->
  <div class="filters">
    <input type="text" placeholder="üîç Buscar tarefa..." [ngModel]="searchTerm()" (ngModelChange)="searchTerm.set($event)">
    <select [ngModel]="selectedCategory()" (ngModelChange)="selectedCategory.set($event)">
      <option value="Todas">Todas</option>
      @for (cat of categories; track cat) {
        <option [value]="cat">{{ cat }}</option>
      }
    </select>
    <button (click)="filter.set('all')">Todas</button>
    <button (click)="filter.set('pending')">Pendentes</button>
    <button (click)="filter.set('completed')">Conclu√≠das</button>
  </div>

  <!-- Nova Tarefa -->
  <form class="new-task" [formGroup]="addTaskForm" (ngSubmit)="addTask()">
    <h3>Adicionar Nova Tarefa</h3>

    <input type="text" placeholder="T√≠tulo da tarefa" formControlName="title">
    <textarea placeholder="Descri√ß√£o da tarefa" formControlName="description"></textarea>

    <input type="date" formControlName="dueDate">
    <select formControlName="priority">
      <option value="Alta">Alta</option>
      <option value="M√©dia">M√©dia</option>
      <option value="Baixa">Baixa</option>
    </select>
    <select formControlName="category">
      @for (cat of categories; track cat) {
        <option [value]="cat">{{ cat }}</option>
      }
    </select>

    <button type="submit" [disabled]="addTaskForm.invalid">+ Adicionar</button>
  </form>

  <!-- Lista de tarefas -->
  <div class="task-list">
    <ul>
      @for (task of filteredTasks(); track task.id) {
        <li [class.completed]="task.isComplete" [class.editing]="editingTask()?.id === task.id">

          @if (editingTask()?.id !== task.id) {
            <input type="checkbox" [checked]="task.isComplete" (change)="updateTaskOnCompletion(task, $event.target.checked)">

            <div class="task-content">
              <span class="task-title">{{ task.title }}</span>

              <div class="task-metadata">
                @if (task.description) {
                  <small><span>üìù</span> {{ task.description }}</small>
                }
                @if (task.dueDate) {
                  <small><span>üìÖ</span> {{ task.dueDate | date:'dd/MM/yyyy' }}</small>
                }
                @if (task.priority) {
                  <small><span>‚ö°</span> {{ task.priority }}</small>
                }
                @if (task.category) {
                  <small><span>üìÇ</span> {{ task.category }}</small>
                }
              </div>
            </div>

            <div class="actions">
              <button (click)="startEdit(task)" class="edit-btn">Editar</button>
              <button (click)="deleteTask(task.id)" class="delete-btn">Excluir</button>
            </div>
          } @else {
            <!-- Edi√ß√£o -->
            <form class="edit-task" [formGroup]="editTaskForm" (ngSubmit)="submitEdit()">
              <input type="text" placeholder="T√≠tulo da tarefa" formControlName="title">
              <textarea placeholder="Descri√ß√£o da tarefa" formControlName="description"></textarea>
              <input type="date" formControlName="dueDate">
              <select formControlName="priority">
                <option>Alta</option>
                <option>M√©dia</option>
                <option>Baixa</option>
              </select>
              <select formControlName="category">
                @for (cat of categories; track cat) {
                  <option [value]="cat">{{ cat }}</option>
                }
              </select>

              <div class="actions">
                <button type="submit" [disabled]="editTaskForm.invalid" class="save-btn">Salvar</button>
                <button type="button" (click)="cancelEdit()" class="cancel-btn">Cancelar</button>
              </div>
            </form>
          }
        </li>
      }
    </ul>
    @if (filteredTasks().length === 0) {
      <p class="empty-message">Nenhuma tarefa encontrada. Comece adicionando uma!</p>
    }
  </div>
</div>
